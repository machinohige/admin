<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約管理システム - グループ呼び出し</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ログイン画面 -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <h1>予約管理システム</h1>
            <p class="subtitle">グループ呼び出し版</p>
            <form id="loginForm" onsubmit="event.preventDefault(); login();">
                <input type="password" id="passwordInput" placeholder="パスワード" required>
                <button type="submit">ログイン</button>
            </form>
            <div id="loginError" class="error-message" style="display: none;">
                パスワードが間違っています
            </div>
        </div>
    </div>

    <!-- メイン画面 -->
    <div id="mainScreen" class="screen">
        <!-- ヘッダー -->
        <div class="header">
            <h1>予約管理システム</h1>
            <div class="header-info">
                <span id="currentDate"></span>
                <select id="dateSelector" onchange="changeDate()">
                    <option value="2025-11-01">11月1日</option>
                    <option value="2025-11-02">11月2日</option>
                </select>
                <button class="logout-btn" onclick="logout()">ログアウト</button>
            </div>
        </div>

        <!-- タブナビゲーション -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('groupCall')">グループ呼び出し</button>
            <button class="tab-btn" onclick="switchTab('reservations')">予約一覧</button>
            <button class="tab-btn" onclick="switchTab('create')">予約作成</button>
            <button class="tab-btn" onclick="switchTab('statistics')">統計</button>
            <button class="tab-btn" onclick="switchTab('settings')">設定</button>
        </div>

        <!-- 営業終了メッセージ -->
        <div id="closedMessage" class="tab-content" style="display: none;">
            <div class="closed-message">
                <h2>営業終了</h2>
                <p>本日の営業は終了しました</p>
            </div>
        </div>

        <!-- グループ呼び出しタブ -->
        <div id="groupCallTab" class="tab-content active">
            <!-- 3つの大枠のコンテナ -->
            <div class="group-call-container">
                <!-- 1. 待機中グループ一覧（優先順位順） -->
                <div class="group-section">
                    <div class="section-header">
                        <h2>📋 待機中グループ（優先順）</h2>
                        <p class="section-description">優先予約を含むグループが先頭に表示されます</p>
                    </div>
                    <div id="upcomingGroupsList" class="upcoming-groups-list">
                        <p class="loading-text">読み込み中...</p>
                    </div>
                </div>

                <!-- 2. 同時呼び出しグループ選択 -->
                <div class="group-section">
                    <div class="section-header">
                        <h2>📢 同時呼び出し</h2>
                        <p class="section-description">複数のグループを同時に呼び出すことができます</p>
                    </div>
                    <div id="multiCallGroupsList" class="multi-call-groups-list">
                        <p class="loading-text">読み込み中...</p>
                    </div>
                </div>

                <!-- 3. 関係者予約スケジュール -->
                <div class="group-section">
                    <div class="section-header">
                        <h2>👥 関係者予約スケジュール</h2>
                        <p class="section-description">時刻指定の関係者予約（X/Y）の予定を表示</p>
                    </div>
                    <div id="vipScheduleList" class="vip-schedule-list">
                        <p class="loading-text">読み込み中...</p>
                    </div>
                </div>
            </div>

            <!-- 旧画面（非表示） -->
            <div style="display: none;">
                <!-- 待機画面 -->
                <div id="waitingScreen" class="group-call-screen waiting">
                    <div class="screen-title">次に呼び出すグループ</div>
                    <div class="group-number-display" id="waitingGroupNumber">-</div>
                    <div class="reservations-in-group" id="waitingReservations">
                        <p class="loading-text">読み込み中...</p>
                    </div>
                    <button class="btn btn-call" id="callButton" onclick="callGroup()" disabled>
                        呼び出す
                    </button>
                </div>

                <!-- 呼び出し中画面 -->
                <div id="callingScreen" class="group-call-screen calling" style="display: none;">
                    <div class="screen-title">呼び出し中</div>
                    <div class="group-number-display" id="callingGroupNumber">-</div>
                    <div class="reservations-in-group" id="callingReservations"></div>
                    <button class="btn btn-back" onclick="backToWaiting()">
                        戻る
                    </button>
                </div>

                <!-- 完了画面 -->
                <div id="completedScreen" class="group-call-screen completed" style="display: none;">
                    <div class="completion-message">✓ 入場完了</div>
                    <div class="group-number-display" id="completedGroupNumber">-</div>
                    <div class="visitor-count" id="completedVisitorCount">-</div>
                    <div class="countdown" id="countdown">3秒後に次のグループへ...</div>
                </div>
            </div>
        </div>

        <!-- 予約一覧タブ -->
        <div id="reservationsTab" class="tab-content">
            <div class="card">
                <h2>予約一覧</h2>
                
                <!-- 検索バー -->
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="予約番号で検索">
                    <select id="typeFilter">
                        <option value="">全タイプ</option>
                        <option value="A">A (11/1 予約)</option>
                        <option value="B">B (11/2 予約)</option>
                        <option value="C">C (11/1 当日)</option>
                        <option value="D">D (11/2 当日)</option>
                        <option value="X">X (11/1 関係者)</option>
                        <option value="Y">Y (11/2 関係者)</option>
                    </select>
                    <select id="statusFilter">
                        <option value="">全ステータス</option>
                        <option value="0">予約受付</option>
                        <option value="1">来店済み</option>
                        <option value="2">キャンセル</option>
                        <option value="3">不在</option>
                    </select>
                    <button class="btn" onclick="searchReservations()">検索</button>
                </div>

                <!-- テーブル -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>予約番号</th>
                                <th>タイプ</th>
                                <th>人数</th>
                                <th>グループ</th>
                                <th>時間</th>
                                <th>ステータス</th>
                                <th>作成日時</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                            <tr><td colspan="8" class="empty-state">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 予約作成タブ -->
        <div id="createTab" class="tab-content">
            <div class="card">
                <h2>新規予約作成</h2>
                
                <form id="newReservationForm" onsubmit="event.preventDefault(); createManualReservation();">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="newResType">予約タイプ</label>
                            <select id="newResType" required onchange="toggleTimeInput()">
                                <option value="">選択してください</option>
                                <option value="C">C - 当日来店 (11/1)</option>
                                <option value="D">D - 当日来店 (11/2)</option>
                                <option value="X">X - 関係者 (11/1)</option>
                                <option value="Y">Y - 関係者 (11/2)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="newResCount">人数</label>
                            <select id="newResCount" required>
                                <option value="">選択してください</option>
                                <option value="1">1人</option>
                                <option value="2">2人</option>
                                <option value="3">3人</option>
                                <option value="4">4人</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="timeInputGroup" style="display: none;">
                            <label for="newResTime">指定時刻（関係者のみ）</label>
                            <input type="time" id="newResTime">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">予約を作成</button>
                    </div>
                </form>
                
                <div id="newResSuccess" class="success-message" style="display: none;">
                    ✅ 予約を作成しました: <strong id="newResNumber"></strong>
                </div>
                <div id="newResError" class="error-message" style="display: none;"></div>
            </div>
        </div>

        <!-- 統計タブ -->
        <div id="statisticsTab" class="tab-content">
            <!-- 統計カード -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>総予約数</h3>
                    <div class="stat-number" id="statTotalReservations">0</div>
                </div>
                <div class="stat-card">
                    <h3>来店済み</h3>
                    <div class="stat-number" id="statVisited">0</div>
                </div>
                <div class="stat-card">
                    <h3>キャンセル</h3>
                    <div class="stat-number" id="statCancelled">0</div>
                </div>
                <div class="stat-card">
                    <h3>待機中</h3>
                    <div class="stat-number" id="statWaiting">0</div>
                </div>
            </div>

            <!-- タイプ別グラフ -->
            <div class="card">
                <h2>タイプ別内訳</h2>
                <div class="chart-container">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>

            <!-- 時間別グラフ -->
            <div class="card">
                <h2>時間別来店数</h2>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 設定タブ -->
        <div id="settingsTab" class="tab-content">
            <div class="card">
                <h2>システム設定</h2>
                
                <div class="settings-section">
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3>予約受付</h3>
                            <p>Webサイトからの予約受付を有効化</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="settingReception" onchange="updateSetting('reception')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3>待ち状況表示</h3>
                            <p>Webサイトでの待ち状況表示を有効化</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="settingJoukyou" onchange="updateSetting('joukyou')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <h3>自動受付停止</h3>
                            <p>営業時間外は自動的に受付を停止</p>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="settingJidou" onchange="updateSetting('jidou')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-info">
                    <h3>設定情報</h3>
                    <ul>
                        <li><strong>予約受付:</strong> ユーザーがWebサイトから予約できるかを制御</li>
                        <li><strong>待ち状況表示:</strong> 現在の待ち状況をWebサイトに表示</li>
                        <li><strong>自動受付停止:</strong> 営業時間を考慮して自動的に受付を停止</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 予約詳細モーダル -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>予約詳細</h2>
            <div id="modalContent"></div>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="cancelReservation()">予約をキャンセル</button>
                <button class="btn" onclick="closeModal()">閉じる</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
