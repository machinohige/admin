<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„ç®¡ç† - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            background: #000;
            color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .login-box {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: #fff;
            border: 2px solid #000;
        }
        input, select, button {
            padding: 12px;
            font-size: 14px;
            border: 2px solid #000;
            margin: 5px 0;
        }
        input[type="password"] { width: 100%; }
        button {
            background: #000;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { opacity: 0.8; }
        .card {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #000;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th { background: #f5f5f5; font-weight: bold; }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-active { background: #e3f2fd; color: #1976d2; }
        .badge-visited { background: #e8f5e9; color: #388e3c; }
        .badge-cancelled { background: #ffebee; color: #d32f2f; }
        .hidden { display: none; }
        .error { color: #f44336; padding: 10px; background: #ffebee; margin: 10px 0; }
        .success { color: #4caf50; padding: 10px; background: #e8f5e9; margin: 10px 0; }
        .filters { display: flex; gap: 10px; margin: 20px 0; }
        .filters input, .filters select { flex: 1; }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #fff;
            padding: 20px;
            border: 2px solid #000;
            text-align: center;
        }
        .stat-number { font-size: 48px; font-weight: bold; }
        .stat-label { font-size: 14px; color: #666; margin-top: 10px; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 24px;
            background: #fff;
            border: 2px solid #000;
            cursor: pointer;
            font-weight: bold;
        }
        .tab.active { background: #000; color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginScreen">
        <div class="login-box">
            <h1>äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p style="margin: 20px 0;">ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ</p>
            <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            <button onclick="login()" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div id="loginError"></div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="mainScreen" class="hidden">
        <div class="header">
            <h1>äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div>
                <span id="currentDate"></span>
                <select id="dateSelector" onchange="changeDate()" style="margin-left: 20px; padding: 8px; border: 2px solid #fff; background: #fff; color: #000; font-weight: bold;">
                    <option value="2025-11-01">11æœˆ1æ—¥</option>
                    <option value="2025-11-02">11æœˆ2æ—¥</option>
                </select>
                <button onclick="logout()" style="margin-left: 20px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>

        <div class="container">
            <!-- ã‚¿ãƒ– -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('reservations')">äºˆç´„ä¸€è¦§</div>
                <div class="tab" onclick="switchTab('create')">äºˆç´„ä½œæˆ</div>
                <div class="tab" onclick="switchTab('statistics')">çµ±è¨ˆ</div>
                <div class="tab" onclick="switchTab('settings')">è¨­å®š</div>
            </div>

            <!-- äºˆç´„ä¸€è¦§ã‚¿ãƒ– -->
            <div id="reservationsTab" class="tab-content active">
                <div class="card">
                    <h2>äºˆç´„ä¸€è¦§</h2>
                    <p style="color: #666; margin-bottom: 15px;">
                        ğŸ“… è¡¨ç¤ºä¸­: <strong id="displayDate">11æœˆ1æ—¥</strong>ã®äºˆç´„
                    </p>
                    
                    <div class="filters">
                        <input type="text" id="searchInput" placeholder="äºˆç´„ç•ªå·ã§æ¤œç´¢">
                        <select id="typeFilter">
                            <option value="">å…¨ã‚¿ã‚¤ãƒ—</option>
                            <option value="A">A (11/1 äºˆç´„)</option>
                            <option value="B">B (11/2 äºˆç´„)</option>
                            <option value="C">C (11/1 å½“æ—¥)</option>
                            <option value="D">D (11/2 å½“æ—¥)</option>
                            <option value="X">X (11/1 é–¢ä¿‚è€…)</option>
                            <option value="Y">Y (11/2 é–¢ä¿‚è€…)</option>
                        </select>
                        <select id="statusFilter">
                            <option value="">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                            <option value="0">äºˆç´„å—ä»˜</option>
                            <option value="1">æ¥åº—æ¸ˆã¿</option>
                            <option value="2">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
                        </select>
                        <button onclick="loadReservations()">æ¤œç´¢</button>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>äºˆç´„ç•ªå·</th>
                                <th>ã‚¿ã‚¤ãƒ—</th>
                                <th>äººæ•°</th>
                                <th>ã‚°ãƒ«ãƒ¼ãƒ—</th>
                                <th>æ™‚é–“</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsBody">
                            <tr><td colspan="7">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- äºˆç´„ä½œæˆã‚¿ãƒ– -->
            <div id="createTab" class="tab-content">
                <div class="card">
                    <h2>æ–°è¦äºˆç´„ä½œæˆ</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        äºˆç´„ã‚’ä½œæˆã™ã‚‹ã¨è‡ªå‹•çš„ã«é©åˆ‡ãªã‚°ãƒ«ãƒ¼ãƒ—ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚<br>
                        ï¼ˆ4äººä»¥ä¸‹ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«è‡ªå‹•é…ç½®ã€å¥‡æ•°=äº‹å‰äºˆç´„ã€å¶æ•°=å½“æ—¥æ¥åº—ï¼‰
                    </p>
                    
                    <div style="max-width: 600px;">
                        <div style="margin: 20px 0;">
                            <label style="display: block; font-weight: bold; margin-bottom: 8px;">äºˆç´„ã‚¿ã‚¤ãƒ—</label>
                            <select id="createType" style="width: 100%; padding: 12px; border: 2px solid #000;">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="C">C - å½“æ—¥æ¥åº— (11/1)</option>
                                <option value="D">D - å½“æ—¥æ¥åº— (11/2)</option>
                                <option value="X">X - é–¢ä¿‚è€… (11/1)</option>
                                <option value="Y">Y - é–¢ä¿‚è€… (11/2)</option>
                            </select>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <label style="display: block; font-weight: bold; margin-bottom: 8px;">äººæ•°</label>
                            <select id="createCount" style="width: 100%; padding: 12px; border: 2px solid #000;">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1">1äºº</option>
                                <option value="2">2äºº</option>
                                <option value="3">3äºº</option>
                                <option value="4">4äºº</option>
                            </select>
                        </div>
                        
                        <div id="timeInputDiv" style="margin: 20px 0; display: none;">
                            <label style="display: block; font-weight: bold; margin-bottom: 8px;">æŒ‡å®šæ™‚åˆ»ï¼ˆé–¢ä¿‚è€…ã®ã¿ï¼‰</label>
                            <input type="time" id="createTime" style="width: 100%; padding: 12px; border: 2px solid #000;">
                        </div>
                        
                        <button onclick="createReservation()" style="width: 100%; padding: 15px; margin-top: 20px;">äºˆç´„ã‚’ä½œæˆ</button>
                        
                        <div id="createResult" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆã‚¿ãƒ– -->
            <div id="statisticsTab" class="tab-content">
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="statTotal">0</div>
                        <div class="stat-label">ç·äºˆç´„æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statVisited">0</div>
                        <div class="stat-label">æ¥åº—æ¸ˆã¿</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statCancelled">0</div>
                        <div class="stat-label">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statWaiting">0</div>
                        <div class="stat-label">å¾…æ©Ÿä¸­</div>
                    </div>
                </div>

                <div class="card">
                    <h2>ã‚¿ã‚¤ãƒ—åˆ¥å†…è¨³</h2>
                    <div id="typeBreakdown"></div>
                </div>
            </div>

            <!-- è¨­å®šã‚¿ãƒ– -->
            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <h2>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
                    <div class="setting-row">
                        <div>
                            <strong>äºˆç´„å—ä»˜</strong>
                            <p style="font-size: 12px; color: #666;">Webã‚µã‚¤ãƒˆã‹ã‚‰ã®äºˆç´„å—ä»˜</p>
                        </div>
                        <input type="checkbox" id="settingReception" onchange="updateSetting('reception', this.checked)">
                    </div>
                    <div class="setting-row">
                        <div>
                            <strong>å¾…ã¡çŠ¶æ³è¡¨ç¤º</strong>
                            <p style="font-size: 12px; color: #666;">Webã‚µã‚¤ãƒˆã§ã®å¾…ã¡çŠ¶æ³è¡¨ç¤º</p>
                        </div>
                        <input type="checkbox" id="settingJoukyou" onchange="updateSetting('joukyou', this.checked)">
                    </div>
                    <div class="setting-row" style="border-bottom: none;">
                        <div>
                            <strong>è‡ªå‹•å—ä»˜åœæ­¢</strong>
                            <p style="font-size: 12px; color: #666;">å–¶æ¥­æ™‚é–“ã‚’è€ƒæ…®ã—ã¦è‡ªå‹•åœæ­¢</p>
                        </div>
                        <input type="checkbox" id="settingJidou" onchange="updateSetting('jidou', this.checked)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://kunugida-reservation-admin-api-pv3b3g64na-an.a.run.app';
        let token = null;
        let currentDate = '2025-11-01';  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯11/1
        let allReservations = [];

        // æ—¥ä»˜æ›´æ–°
        setInterval(() => {
            const now = new Date();
            const elem = document.getElementById('currentDate');
            if (elem) {
                elem.textContent = now.toLocaleString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
            }
        }, 1000);

        // ãƒ­ã‚°ã‚¤ãƒ³
        async function login() {
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            try {
                const res = await fetch(`${API_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    token = data.token;
                    localStorage.setItem('token', token);
                    showMain();
                } else {
                    errorDiv.innerHTML = '<div class="error">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</div>';
                }
            } catch (err) {
                errorDiv.innerHTML = '<div class="error">æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + err.message + '</div>';
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            token = null;
            localStorage.removeItem('token');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        // ãƒ¡ã‚¤ãƒ³ç”»é¢è¡¨ç¤º
        function showMain() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            // æ—¥ä»˜ã‚»ãƒ¬ã‚¯ã‚¿ã®åˆæœŸå€¤ã‚’è¨­å®š
            document.getElementById('dateSelector').value = currentDate;
            
            loadReservations();
            loadStatistics();
            loadSettings();
        }

        // èµ·å‹•æ™‚ã®èªè¨¼ãƒã‚§ãƒƒã‚¯
        window.onload = function() {
            token = localStorage.getItem('token');
            if (token) showMain();
        };

        // æ—¥ä»˜å¤‰æ›´
        function changeDate() {
            currentDate = document.getElementById('dateSelector').value;
            console.log('Date changed to:', currentDate);
            
            // ç¾åœ¨ã®ã‚¿ãƒ–ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabText = activeTab.textContent;
                if (tabText.includes('äºˆç´„ä¸€è¦§')) {
                    loadReservations();
                } else if (tabText.includes('çµ±è¨ˆ')) {
                    loadStatistics();
                }
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(name + 'Tab').classList.add('active');
            
            if (name === 'reservations') loadReservations();
            if (name === 'statistics') loadStatistics();
            if (name === 'settings') loadSettings();
        }

        // ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            const typeSelect = document.getElementById('createType');
            if (typeSelect) {
                typeSelect.addEventListener('change', function() {
                    const timeDiv = document.getElementById('timeInputDiv');
                    if (this.value === 'X' || this.value === 'Y') {
                        timeDiv.style.display = 'block';
                    } else {
                        timeDiv.style.display = 'none';
                    }
                });
            }
        });

        // äºˆç´„ä½œæˆ
        async function createReservation() {
            const type = document.getElementById('createType').value;
            const count = document.getElementById('createCount').value;
            const time = document.getElementById('createTime').value;
            const resultDiv = document.getElementById('createResult');
            
            if (!type || !count) {
                resultDiv.innerHTML = '<div class="error">ã‚¿ã‚¤ãƒ—ã¨äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            if ((type === 'X' || type === 'Y') && !time) {
                resultDiv.innerHTML = '<div class="error">é–¢ä¿‚è€…äºˆç´„ã«ã¯æ™‚åˆ»ã‚’æŒ‡å®šã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            const date = (type === 'C' || type === 'X') ? '2025-11-01' : '2025-11-02';
            
            const requestData = {
                type: type,
                count: parseInt(count),
                date: date
            };
            
            if (type === 'X' || type === 'Y') {
                requestData.time = time;
            }
            
            resultDiv.innerHTML = '<p>ä½œæˆä¸­...</p>';
            
            try {
                const res = await fetch(`${API_URL}/api/admin/reservations/create`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    resultDiv.innerHTML = `<div class="success">âœ… äºˆç´„ã‚’ä½œæˆã—ã¾ã—ãŸ: <strong>${data.reservation_id}</strong></div>`;
                    document.getElementById('createType').value = '';
                    document.getElementById('createCount').value = '';
                    document.getElementById('createTime').value = '';
                    document.getElementById('timeInputDiv').style.display = 'none';
                    
                    setTimeout(() => {
                        resultDiv.innerHTML = '';
                    }, 5000);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ ã‚¨ãƒ©ãƒ¼: ${data.error}</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="error">âŒ ã‚¨ãƒ©ãƒ¼: ${err.message}</div>`;
            }
        }

        // äºˆç´„èª­ã¿è¾¼ã¿
        async function loadReservations() {
            const tbody = document.getElementById('reservationsBody');
            tbody.innerHTML = '<tr><td colspan="7">èª­ã¿è¾¼ã¿ä¸­...</td></tr>';
            
            // æ—¥ä»˜è¡¨ç¤ºã‚’æ›´æ–°
            const displayDate = document.getElementById('displayDate');
            if (displayDate) {
                displayDate.textContent = currentDate === '2025-11-01' ? '11æœˆ1æ—¥' : '11æœˆ2æ—¥';
            }
            
            console.log('Loading reservations for date:', currentDate);
            
            try {
                const res = await fetch(`${API_URL}/api/admin/reservations?date=${currentDate}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await res.json();
                
                if (!res.ok) throw new Error(data.error);
                
                allReservations = data.reservations || [];
                console.log('Loaded reservations:', allReservations.length);
                displayReservations();
            } catch (err) {
                tbody.innerHTML = `<tr><td colspan="7" class="error">ã‚¨ãƒ©ãƒ¼: ${err.message}</td></tr>`;
            }
        }

        // äºˆç´„è¡¨ç¤º
        function displayReservations() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filtered = allReservations.filter(r => {
                if (search && !r.reservation_id.toLowerCase().includes(search)) return false;
                if (typeFilter && r.type !== typeFilter) return false;
                if (statusFilter && r.status !== parseInt(statusFilter)) return false;
                return true;
            });
            
            const tbody = document.getElementById('reservationsBody');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">è©²å½“ãªã—</td></tr>';
                return;
            }
            
            tbody.innerHTML = filtered.map(r => {
                const statusText = r.status === 0 ? 'äºˆç´„å—ä»˜' : r.status === 1 ? 'æ¥åº—æ¸ˆã¿' : 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
                const statusClass = r.status === 0 ? 'badge-active' : r.status === 1 ? 'badge-visited' : 'badge-cancelled';
                
                return `<tr>
                    <td><strong>${r.reservation_id}</strong></td>
                    <td>${r.type}</td>
                    <td>${r.count}äºº</td>
                    <td>${r.group || '-'}</td>
                    <td>${r.time || '-'}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>
                        ${r.status === 0 ? `
                            <button onclick="markVisit('${r.reservation_id}')" style="font-size:12px;">æ¥åº—</button>
                            <button onclick="markCancel('${r.reservation_id}')" style="font-size:12px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        ` : ''}
                    </td>
                </tr>`;
            }).join('');
        }

        // æ¥åº—ãƒãƒ¼ã‚¯
        async function markVisit(id) {
            if (!confirm(`${id} ã‚’æ¥åº—æ¸ˆã¿ã«ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            
            try {
                const res = await fetch(`${API_URL}/api/admin/reservations/${id}/visit`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (res.ok) {
                    alert('æ¥åº—æ¸ˆã¿ã«ã—ã¾ã—ãŸ');
                    loadReservations();
                    loadStatistics();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
            } catch (err) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
            }
        }

        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒ¼ã‚¯
        async function markCancel(id) {
            if (!confirm(`${id} ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            
            try {
                const res = await fetch(`${API_URL}/api/admin/reservations/${id}/cancel`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (res.ok) {
                    alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                    loadReservations();
                    loadStatistics();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                }
            } catch (err) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
            }
        }

        // çµ±è¨ˆèª­ã¿è¾¼ã¿
        async function loadStatistics() {
            try {
                const res = await fetch(`${API_URL}/api/admin/statistics?date=${currentDate}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    document.getElementById('statTotal').textContent = data.total;
                    document.getElementById('statVisited').textContent = data.visited;
                    document.getElementById('statCancelled').textContent = data.cancelled;
                    document.getElementById('statWaiting').textContent = data.waiting;
                    
                    const breakdown = document.getElementById('typeBreakdown');
                    breakdown.innerHTML = Object.entries(data.by_type)
                        .map(([type, count]) => `<div style="padding:10px;border-bottom:1px solid #ddd;">ã‚¿ã‚¤ãƒ— ${type}: <strong>${count}ä»¶</strong></div>`)
                        .join('');
                }
            } catch (err) {
                console.error('Statistics error:', err);
            }
        }

        // è¨­å®šèª­ã¿è¾¼ã¿
        async function loadSettings() {
            try {
                const res = await fetch(`${API_URL}/api/admin/settings`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    document.getElementById('settingReception').checked = data.reception;
                    document.getElementById('settingJoukyou').checked = data.joukyou;
                    document.getElementById('settingJidou').checked = data.jidou;
                }
            } catch (err) {
                console.error('Settings error:', err);
            }
        }

        // è¨­å®šæ›´æ–°
        async function updateSetting(key, value) {
            try {
                const res = await fetch(`${API_URL}/api/admin/settings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ key, value })
                });
                
                if (!res.ok) {
                    alert('è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    loadSettings();
                }
            } catch (err) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
                loadSettings();
            }
        }
    </script>
</body>
</html>
