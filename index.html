<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚¿ãƒƒãƒ•ç”¨ç®¡ç†ç”»é¢ - 2J ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background: #f5f5f5;
            color: #000000;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1880px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .header {
            grid-column: 1 / -1;
            background: #000000;
            color: #ffffff;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-left .status {
            font-size: 14px;
            opacity: 0.8;
        }

        .header-right {
            text-align: right;
        }

        .header-right .turn {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header-right .time {
            font-size: 14px;
            opacity: 0.8;
        }

        .card {
            background: #ffffff;
            border: 2px solid #000000;
            padding: 25px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #000000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            font-size: 14px;
            padding: 5px 15px;
            background: #f0f0f0;
            border: 2px solid #000000;
            font-weight: 600;
        }

        .status-badge.waiting {
            background: #fff8e1;
        }

        .status-badge.calling {
            background: #e3f2fd;
        }

        .status-badge.serving {
            background: #e8f5e9;
        }

        .current-call-section {
            grid-column: 1 / -1;
        }

        .group-display {
            background: #f8f8f8;
            border: 3px solid #000000;
            padding: 30px;
            margin-bottom: 20px;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .group-number {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .group-type {
            font-size: 16px;
            background: #000000;
            color: #ffffff;
            padding: 8px 16px;
            font-weight: 600;
        }

        .members-list {
            display: grid;
            gap: 12px;
            margin-bottom: 25px;
        }

        .member-item {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            transition: all 0.3s;
        }

        .member-item.absent {
            background: #f5f5f5;
            opacity: 0.5;
            border-color: #cccccc;
        }

        .member-info {
            font-weight: 600;
            flex: 1;
        }

        .member-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .member-badge {
            font-size: 12px;
            padding: 4px 12px;
            border: 1px solid #000000;
            background: #ffffff;
        }

        .member-button {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            border: 2px solid #000000;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .member-button:hover {
            opacity: 0.8;
        }

        .member-button.arrived {
            background: #000000;
            color: #ffffff;
        }

        .member-status {
            font-size: 14px;
            font-weight: 600;
            padding: 8px 16px;
        }

        .member-status.arrived {
            color: #2e7d32;
        }

        .member-status.absent {
            color: #d32f2f;
        }

        .button {
            padding: 18px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .button:hover:not(:disabled) {
            opacity: 0.8;
        }

        .button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .button-primary {
            background: #000000;
            color: #ffffff;
        }

        .button-secondary {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        .button-danger {
            background: #ffffff;
            color: #d32f2f;
            border: 2px solid #d32f2f;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .single-action {
            display: block;
            width: 100%;
        }

        .qr-scan-section {
            text-align: center;
            padding: 30px;
            background: #f8f8f8;
            border: 3px dashed #000000;
            margin-top: 20px;
        }

        .qr-scan-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        .qr-scan-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .qr-scan-subtext {
            font-size: 14px;
            color: #666666;
        }

        .qr-result {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border: 2px solid #000000;
            font-size: 16px;
            font-weight: 600;
            display: none;
        }

        .waiting-section {
            display: grid;
            gap: 15px;
        }

        .waiting-card {
            background: #f8f8f8;
            border: 2px solid #000000;
            padding: 20px;
        }

        .waiting-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .waiting-count {
            display: flex;
            gap: 30px;
            font-size: 14px;
        }

        .count-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .count-number {
            font-size: 32px;
            font-weight: 700;
        }

        .count-label {
            font-size: 14px;
            color: #666666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: #f8f8f8;
            border: 2px solid #000000;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }

        .next-preview {
            background: #fff8e1;
            border: 2px solid #000000;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .next-preview-label {
            font-size: 14px;
            color: #666666;
            margin-bottom: 10px;
        }

        .next-preview-number {
            font-size: 32px;
            font-weight: 700;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>2J ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ - ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢</h1>
                <div class="status">11æœˆ1æ—¥ï¼ˆé‡‘ï¼‰ | ãƒ­ã‚°ã‚¤ãƒ³ä¸­</div>
            </div>
            <div class="header-right">
                <div class="turn" id="currentTurn">ç¾åœ¨: äºˆç´„ã‚ã‚Šå„ªå…ˆã‚¿ãƒ¼ãƒ³</div>
                <div class="time" id="nextTime">æ¬¡å›äºˆæ¸¬æ™‚åˆ»: 14:35</div>
            </div>
        </div>

        <div class="card current-call-section">
            <div class="card-title">
                <span id="sectionTitle">ğŸ“‹ æ¬¡ã®æ¡ˆå†…äºˆå®š</span>
                <span class="status-badge waiting" id="statusBadge">å¾…æ©Ÿä¸­</span>
            </div>
            
            <!-- å¾…æ©Ÿä¸­ï¼šæ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div id="waitingState">
                <div class="next-preview">
                    <div class="next-preview-label">æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—</div>
                    <div class="next-preview-number" id="nextGroupNumber">GROUP 043</div>
                </div>
                
                <div class="members-list" id="nextMembersList" style="margin-bottom: 20px;">
                    <!-- æ¬¡ã®ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                
                <div style="text-align: center; margin-bottom: 20px; font-size: 18px; font-weight: 600;" id="nextTotalPeople">
                    åˆè¨ˆ: 4äºº
                </div>
                
                <button class="button button-primary single-action" onclick="callGroup()">
                    ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‘¼ã³å‡ºã™
                </button>
            </div>

            <!-- å‘¼ã³å‡ºã—ä¸­ï¼šåˆ°ç€ç¢ºèª -->
            <div id="callingState" class="hidden">
                <div class="group-display">
                    <div class="group-header">
                        <div class="group-number" id="currentGroupNumber">GROUP 043</div>
                        <div class="group-type" id="currentGroupType">äºˆç´„ã‚ã‚Šå„ªå…ˆ</div>
                    </div>

                    <div class="members-list" id="membersList">
                        <!-- ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>

                    <div style="text-align: center; margin-bottom: 20px; font-size: 18px; font-weight: 600;" id="totalPeople">
                        åˆè¨ˆ: 0äºº | åˆ°ç€: 0äºº | ä¸åœ¨: 0äºº
                    </div>

                    <div class="action-buttons">
                        <button class="button button-primary" onclick="startServing()" id="startServingButton" disabled>
                            âœ“ æ¡ˆå†…ã‚’é–‹å§‹
                        </button>
                        <button class="button button-danger" onclick="cancelGroup()">
                            âœ— ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    </div>
                </div>

                <div class="qr-scan-section">
                    <div class="qr-scan-icon">ğŸ“·</div>
                    <div class="qr-scan-text">QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</div>
                    <div class="qr-scan-subtext">ã‚«ãƒ¡ãƒ©ã¾ãŸã¯QRãƒªãƒ¼ãƒ€ãƒ¼ã§èª­ã¿å–ã£ã¦ãã ã•ã„</div>
                    <button class="button button-primary" style="margin-top: 20px; width: 300px;" onclick="simulateScan()">
                        ã‚¹ã‚­ãƒ£ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                    </button>
                    <div class="qr-result" id="qrResult">
                        âœ“ R12345 ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆ2äººï¼‰
                    </div>
                </div>
            </div>

            <!-- æ¡ˆå†…ä¸­ -->
            <div id="servingState" class="hidden">
                <div class="group-display">
                    <div class="group-header">
                        <div class="group-number" id="servingGroupNumber">GROUP 043</div>
                        <div class="group-type">ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³å®Ÿæ–½ä¸­</div>
                    </div>

                    <div style="text-align: center; padding: 40px; font-size: 20px; color: #666666;">
                        ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½ä¸­ã§ã™...<br>
                        <span style="font-size: 16px; margin-top: 10px; display: block;">
                            å®Œäº†ã—ãŸã‚‰ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„
                        </span>
                    </div>

                    <button class="button button-primary single-action" onclick="completeServing()">
                        æ¡ˆå†…å®Œäº† - æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¸
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ‘¥ å¾…æ©ŸçŠ¶æ³</div>
            
            <div class="waiting-section">
                <div class="waiting-card">
                    <div class="waiting-title">äºˆç´„ã‚ã‚Šå¾…æ©Ÿ</div>
                    <div class="waiting-count">
                        <div class="count-item">
                            <span class="count-number" id="reservationGroups">5</span>
                            <span class="count-label">çµ„</span>
                        </div>
                        <div class="count-item">
                            <span class="count-number" id="reservationPeople">15</span>
                            <span class="count-label">äºº</span>
                        </div>
                    </div>
                </div>

                <div class="waiting-card">
                    <div class="waiting-title">äºˆç´„ãªã—å¾…æ©Ÿ</div>
                    <div class="waiting-count">
                        <div class="count-item">
                            <span class="count-number" id="walkinGroups">3</span>
                            <span class="count-label">çµ„</span>
                        </div>
                        <div class="count-item">
                            <span class="count-number" id="walkinPeople">8</span>
                            <span class="count-label">äºº</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ“Š æœ¬æ—¥ã®å®Ÿç¸¾</div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ¡ˆå†…çµ„æ•°</div>
                    <div class="stat-value" id="totalGroups">42</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç·äººæ•°</div>
                    <div class="stat-value" id="totalPeopleServed">162</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ¬ å¸­çµ„æ•°</div>
                    <div class="stat-value" id="absentGroups">3</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentState = 'waiting'; // waiting, calling, serving
        let currentGroupId = null;
        let currentGroupNum = 43;
        let memberStatuses = {}; // { memberId: 'pending' | 'arrived' | 'absent' }
        let currentMembers = [];
        let nextMembers = []; // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼

        // åˆæœŸåŒ–æ™‚ã«æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç”Ÿæˆ
        function initNextGroup() {
            nextMembers = generateDummyMembers();
            updateNextMembersList();
        }

        function updateNextMembersList() {
            const membersList = document.getElementById('nextMembersList');
            membersList.innerHTML = '';
            
            let totalPeople = 0;
            
            nextMembers.forEach(member => {
                totalPeople += member.people;
                const badge = member.type === 'reservation' ? 'äºˆç´„ã‚ã‚Š' : 'äºˆç´„ãªã—';
                
                membersList.innerHTML += `
                    <div class="member-item">
                        <div class="member-info">${member.id} - ${member.people}äºº</div>
                        <div class="member-actions">
                            <div class="member-badge">${badge}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('nextTotalPeople').textContent = `åˆè¨ˆ: ${totalPeople}äºº`;
        }

        function setState(newState) {
            currentState = newState;
            
            // ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’éè¡¨ç¤º
            document.getElementById('waitingState').classList.add('hidden');
            document.getElementById('callingState').classList.add('hidden');
            document.getElementById('servingState').classList.add('hidden');
            
            // è©²å½“ã™ã‚‹çŠ¶æ…‹ã‚’è¡¨ç¤º
            if (newState === 'waiting') {
                document.getElementById('waitingState').classList.remove('hidden');
                document.getElementById('sectionTitle').textContent = 'ğŸ“‹ æ¬¡ã®æ¡ˆå†…äºˆå®š';
                document.getElementById('statusBadge').textContent = 'å¾…æ©Ÿä¸­';
                document.getElementById('statusBadge').className = 'status-badge waiting';
            } else if (newState === 'calling') {
                document.getElementById('callingState').classList.remove('hidden');
                document.getElementById('sectionTitle').textContent = 'ğŸ“¢ å‘¼ã³å‡ºã—ä¸­';
                document.getElementById('statusBadge').textContent = 'åˆ°ç€ç¢ºèªä¸­';
                document.getElementById('statusBadge').className = 'status-badge calling';
            } else if (newState === 'serving') {
                document.getElementById('servingState').classList.remove('hidden');
                document.getElementById('sectionTitle').textContent = 'ğŸ® æ¡ˆå†…ä¸­';
                document.getElementById('statusBadge').textContent = 'å®Ÿæ–½ä¸­';
                document.getElementById('statusBadge').className = 'status-badge serving';
            }
        }

        function callGroup() {
            if (confirm('GROUP ' + String(currentGroupNum).padStart(3, '0') + ' ã‚’å‘¼ã³å‡ºã—ã¾ã™ã‹ï¼Ÿ\nã‚µã‚¤ãƒãƒ¼ã‚¸ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚')) {
                // ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’è¨­å®š
                document.getElementById('currentGroupNumber').textContent = 'GROUP ' + String(currentGroupNum).padStart(3, '0');
                document.getElementById('servingGroupNumber').textContent = 'GROUP ' + String(currentGroupNum).padStart(3, '0');
                
                // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç¾åœ¨ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ç§»å‹•
                currentMembers = nextMembers;
                updateMembersList(currentMembers);
                
                // ãƒ¡ãƒ³ãƒãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
                memberStatuses = {};
                currentMembers.forEach(m => {
                    memberStatuses[m.id] = 'pending';
                });
                
                updateGroupSummary();
                setState('calling');
                
                // å®Ÿè£…: APIã‚³ãƒ¼ãƒ«
                /*
                fetch('/api/groups/call-next', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: getCurrentDate() })
                })
                .then(r => r.json())
                .then(data => {
                    currentGroupId = data.groupId;
                    currentMembers = data.members;
                    updateMembersList(data.members);
                });
                */
            }
        }

        function markMemberArrived(memberId) {
            memberStatuses[memberId] = 'arrived';
            updateMemberDisplay(memberId);
            updateGroupSummary();
        }

        function markMemberAbsent(memberId) {
            if (confirm('ã“ã®æ–¹ã¯æ¥ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ')) {
                memberStatuses[memberId] = 'absent';
                updateMemberDisplay(memberId);
                updateGroupSummary();
            }
        }

        function updateMemberDisplay(memberId) {
            const memberItem = document.querySelector(`[data-member-id="${memberId}"]`);
            const actionsDiv = memberItem.querySelector('.member-actions');
            const status = memberStatuses[memberId];
            
            if (status === 'arrived') {
                memberItem.classList.remove('absent');
                actionsDiv.innerHTML = `
                    ${actionsDiv.querySelector('.member-badge').outerHTML}
                    <span class="member-status arrived">âœ“ åˆ°ç€æ¸ˆã¿</span>
                `;
            } else if (status === 'absent') {
                memberItem.classList.add('absent');
                actionsDiv.innerHTML = `
                    ${actionsDiv.querySelector('.member-badge').outerHTML}
                    <span class="member-status absent">âœ— ä¸åœ¨</span>
                `;
            }
        }

        function updateGroupSummary() {
            const arrivedCount = Object.values(memberStatuses).filter(s => s === 'arrived').length;
            const absentCount = Object.values(memberStatuses).filter(s => s === 'absent').length;
            const totalCount = Object.keys(memberStatuses).length;
            
            // åˆè¨ˆäººæ•°ã‚’è¨ˆç®—
            const memberItems = document.querySelectorAll('.member-item');
            let totalPeople = 0;
            let arrivedPeople = 0;
            let absentPeople = 0;
            
            memberItems.forEach(item => {
                const memberId = item.dataset.memberId;
                const peopleText = item.querySelector('.member-info').textContent;
                const people = parseInt(peopleText.match(/(\d+)äºº/)[1]);
                
                totalPeople += people;
                
                if (memberStatuses[memberId] === 'arrived') {
                    arrivedPeople += people;
                } else if (memberStatuses[memberId] === 'absent') {
                    absentPeople += people;
                }
            });
            
            document.getElementById('totalPeople').textContent = 
                `åˆè¨ˆ: ${totalPeople}äºº | åˆ°ç€: ${arrivedPeople}äºº | ä¸åœ¨: ${absentPeople}äºº`;
            
            // æ¡ˆå†…é–‹å§‹ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
            const startButton = document.getElementById('startServingButton');
            if (arrivedCount > 0 || absentCount === totalCount) {
                startButton.disabled = false;
            } else {
                startButton.disabled = true;
            }
        }

        function startServing() {
            const arrivedCount = Object.values(memberStatuses).filter(s => s === 'arrived').length;
            const absentCount = Object.values(memberStatuses).filter(s => s === 'absent').length;
            
            if (arrivedCount === 0) {
                alert('åˆ°ç€ã—ã¦ã„ã‚‹æ–¹ãŒã„ã¾ã›ã‚“');
                return;
            }
            
            let message = 'æ¡ˆå†…ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ\n\n';
            message += `åˆ°ç€: ${arrivedCount}å\n`;
            if (absentCount > 0) {
                message += `ä¸åœ¨: ${absentCount}å\n\n`;
                message += 'ä¸åœ¨ã®æ–¹ã¯æ¬ å¸­ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚';
            }
            
            if (confirm(message)) {
                setState('serving');
                
                // å®Ÿè£…: APIã‚³ãƒ¼ãƒ«
                /*
                fetch('/api/groups/start-serving', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        groupId: currentGroupId,
                        memberStatuses: memberStatuses
                    })
                });
                */
            }
        }

        function completeServing() {
            if (confirm('æ¡ˆå†…ãŒå®Œäº†ã—ã¾ã—ãŸã‹ï¼Ÿ')) {
                // çµ±è¨ˆã‚’æ›´æ–°
                const arrivedCount = Object.values(memberStatuses).filter(s => s === 'arrived').length;
                const absentCount = Object.values(memberStatuses).filter(s => s === 'absent').length;
                
                const currentTotal = parseInt(document.getElementById('totalGroups').textContent);
                document.getElementById('totalGroups').textContent = currentTotal + 1;
                
                const memberItems = document.querySelectorAll('#membersList .member-item');
                let arrivedPeople = 0;
                memberItems.forEach(item => {
                    const memberId = item.dataset.memberId;
                    if (memberStatuses[memberId] === 'arrived') {
                        const peopleText = item.querySelector('.member-info').textContent;
                        arrivedPeople += parseInt(peopleText.match(/(\d+)äºº/)[1]);
                    }
                });
                
                const currentPeople = parseInt(document.getElementById('totalPeopleServed').textContent);
                document.getElementById('totalPeopleServed').textContent = currentPeople + arrivedPeople;
                
                if (absentCount > 0) {
                    const currentAbsent = parseInt(document.getElementById('absentGroups').textContent);
                    document.getElementById('absentGroups').textContent = currentAbsent + absentCount;
                }
                
                // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¸
                currentGroupNum++;
                document.getElementById('nextGroupNumber').textContent = 'GROUP ' + String(currentGroupNum).padStart(3, '0');
                
                // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç”Ÿæˆ
                nextMembers = generateDummyMembers();
                updateNextMembersList();
                
                setState('waiting');
                
                // å®Ÿè£…: APIã‚³ãƒ¼ãƒ«
                /*
                fetch('/api/groups/complete', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        groupId: currentGroupId
                    })
                });
                */
            }
        }

        function cancelGroup() {
            if (confirm('ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ')) {
                const absentCount = Object.keys(memberStatuses).length;
                const currentAbsent = parseInt(document.getElementById('absentGroups').textContent);
                document.getElementById('absentGroups').textContent = currentAbsent + absentCount;
                
                // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¸
                currentGroupNum++;
                document.getElementById('nextGroupNumber').textContent = 'GROUP ' + String(currentGroupNum).padStart(3, '0');
                
                // æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç”Ÿæˆ
                nextMembers = generateDummyMembers();
                updateNextMembersList();
                
                setState('waiting');
                
                // å®Ÿè£…: APIã‚³ãƒ¼ãƒ«
                /*
                fetch('/api/groups/cancel', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ groupId: currentGroupId })
                });
                */
            }
        }

        function simulateScan() {
            const memberIds = Object.keys(memberStatuses).filter(id => memberStatuses[id] === 'pending');
            if (memberIds.length === 0) {
                alert('å…¨å“¡ã®ç¢ºèªãŒå®Œäº†ã—ã¦ã„ã¾ã™');
                return;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¡ãƒ³ãƒãƒ¼IDã‚’é¸æŠ
            const randomMemberId = memberIds[Math.floor(Math.random() * memberIds.length)];
            const memberItem = document.querySelector(`[data-member-id="${randomMemberId}"]`);
            const peopleText = memberItem.querySelector('.member-info').textContent;
            const people = parseInt(peopleText.match(/(\d+)äºº/)[1]);
            
            const result = document.getElementById('qrResult');
            result.textContent = `âœ“ ${randomMemberId} ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆ${people}äººï¼‰`;
            result.style.display = 'block';
            
            // è‡ªå‹•çš„ã«åˆ°ç€ã¨ã—ã¦ãƒãƒ¼ã‚¯
            markMemberArrived(randomMemberId);
            
            setTimeout(() => {
                result.style.display = 'none';
            }, 3000);
        }

        function generateDummyMembers() {
            const types = ['reservation', 'walkIn'];
            const memberCount = Math.floor(2 + Math.random() * 2);
            const members = [];
            
            for (let i = 0; i < memberCount; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const prefix = type === 'reservation' ? 'R' : 'W';
                const id = prefix + Math.floor(10000 + Math.random() * 90000);
                const people = Math.floor(1 + Math.random() * 3);
                
                members.push({ id, people, type });
            }
            
            return members;
        }

        function updateMembersList(members) {
            const membersList = document.getElementById('membersList');
            membersList.innerHTML = '';
            
            members.forEach(member => {
                const badge = member.type === 'reservation' ? 'äºˆç´„ã‚ã‚Š' : 'äºˆç´„ãªã—';
                
                membersList.innerHTML += `
                    <div class="member-item" data-member-id="${member.id}">
                        <div class="member-info">${member.id} - ${member.people}äºº</div>
                        <div class="member-actions">
                            <div class="member-badge">${badge}</div>
                            <button class="member-button" onclick="markMemberArrived('${member.id}')">åˆ°ç€</button>
                            <button class="member-button" onclick="markMemberAbsent('${member.id}')">ã„ãªã„</button>
                        </div>
                    </div>
                `;
            });
        }

        function updateWaitingStatus() {
            document.getElementById('reservationGroups').textContent = Math.floor(3 + Math.random() * 8);
            document.getElementById('reservationPeople').textContent = Math.floor(10 + Math.random() * 20);
            document.getElementById('walkinGroups').textContent = Math.floor(2 + Math.random() * 6);
            document.getElementById('walkinPeople').textContent = Math.floor(5 + Math.random() * 15);
        }

        // åˆæœŸåŒ–
        initNextGroup();
        setState('waiting');
        setInterval(updateWaitingStatus, 10000);
    </script>
</body>
</html>
